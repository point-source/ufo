<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UFO Parametric Cutter (metric)</title>
    <style>
        body {
            font-family: system-ui, Segoe UI, Roboto, Arial;
            margin: 18px;
            color: #111
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            max-width: 1200px;
            align-items: start
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px
        }

        input,
        select {
            width: 100%;
            padding: 6px 8px;
            font-size: 14px;
            box-sizing: border-box
        }

        .row {
            margin-bottom: 8px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start
        }

        .panel {
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 8px;
            background: #fafafa
        }

        .flex {
            display: flex;
            gap: 12px
        }

        .preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px
        }

        svg {
            border: 1px solid #ccc;
            background: white;
            width: 100%;
            height: 360px
        }

        .shapes {
            margin-top: 12px
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        td,
        th {
            padding: 6px;
            border: 1px solid #eee;
            font-size: 13px
        }

        button {
            padding: 8px 12px;
            font-size: 14px
        }

        .small {
            font-size: 12px;
            color: #555
        }

        .small-top-input {
            border: 2px solid var(--small-top-color, #c475e1) !important;
        }

        .main-upper-input {
            border: 2px solid var(--main-upper-color, #11e0e4) !important;
        }

        .cylinder-input {
            border: 2px solid var(--cylinder-color, #c2f0ff) !important;
        }

        .main-lower-input {
            border: 2px solid var(--main-lower-color, #75a3ff) !important;
        }
    </style>
</head>

<body>
    <h1>UFO parametric cutter — <span id="unitTitle">metric (mm)</span></h1>
    <p class="small">Interactive single-file generator: enter sizes (<span id="unitLabel">mm</span>), adjust panels, and
        see preview + flat panel
        shapes and counts. Material thickness fixed to <span id="materialThickness">5 mm</span> (foam board) — suitable
        for hand-fitting and taping.</p>
    <p class="small">Source code available on <a href="https://github.com/point-source/ufo" target="_blank">GitHub</a> |
        Inspired by <a href="https://manningkrull.com/manningmakesstuff/48-flying-saucer-halloween-decoration"
            target="_blank">Manning Makes Stuff's 48in Flying Saucer</a></p>
    <div class="controls panel">
        <div>
            <div class="row"><label>Small diameter (<span class="unit-text">mm</span>) - top cap only</label><input
                    id="smallDiameter" type="number" value="260" class="small-top-input"></div>
            <div class="row"><label>Main outer diameter (<span class="unit-text">mm</span>) - cone
                    transitions</label><input id="mainOuterDiameter" type="number" value="410" class="main-upper-input">
            </div>
            <div class="row"><label>Main inner diameter (<span class="unit-text">mm</span>) - cylinder
                    walls</label><input id="mainInnerDiameter" type="number" value="914" class="cylinder-input"></div>
            <div class="row"><label>Total height (<span class="unit-text">mm</span>) - calculated from
                    sections</label><input id="totalHeight" type="number" value="0" readonly></div>
        </div>
        <div>
            <div class="row"><label>Top cone height (<span class="unit-text">mm</span>)</label><input id="topConeHeight"
                    type="number" value="160" class="small-top-input">
            </div>
            <div class="row"><label>Main upper cone height (<span class="unit-text">mm</span>)</label><input
                    id="mainUpperHeight" type="number" value="130" class="main-upper-input"></div>
            <div class="row"><label>Cylinder height (<span class="unit-text">mm</span>)</label><input
                    id="cylinderHeight" type="number" value="60" class="cylinder-input">
            </div>
            <div class="row"><label>Main lower cone height (<span class="unit-text">mm</span>)</label><input
                    id="mainLowerHeight" type="number" value="130" class="main-lower-input"></div>
        </div>
        <div>
            <div class="row"><label>Small-top panel count (N)</label><input id="nSmall" type="number" value="16" min="3"
                    class="small-top-input"></div>
            <div class="row"><label>Main-ring panel count (N)</label><input id="nMain" type="number" value="32" min="3"
                    class="main-upper-input">
            </div>
            <div class="row"><label>Hole diameter for windows (<span class="unit-text">mm</span>)</label><input
                    id="holeDia" type="number" value="25.4" class="cylinder-input"></div>
            <div class="row"><label>Panel divider color</label><input id="lineColor" type="color" value="#545454"></div>
        </div>
        <div>
            <div class="row"><label>Small-top cone color</label><input id="smallTopColor" type="color" value="#c475e1">
            </div>
            <div class="row"><label>Main upper cone color</label><input id="mainUpperColor" type="color"
                    value="#11e0e4"></div>
            <div class="row"><label>Cylinder color</label><input id="cylinderColor" type="color" value="#c2f0ff"></div>
            <div class="row"><label>Main lower cone color</label><input id="mainLowerColor" type="color"
                    value="#75a3ff"></div>
        </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
        <div class="small">Views update automatically as you change values.</div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
            <label for="unitToggle" style="margin:0;font-size:13px">Units:</label>
            <select id="unitToggle" style="width:auto;padding:4px 8px;font-size:13px">
                <option value="metric">Metric (mm)</option>
                <option value="imperial">Imperial (in)</option>
            </select>
        </div>
    </div>

    <div class="preview">
        <div class="panel">
            <h3>Top-down</h3>
            <svg id="svgTop" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <div class="panel">
            <h3>Side view</h3>
            <svg id="svgSide" viewBox="0 0 1000 400" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
    </div>

    <div class="shapes panel">
        <h3>Unique flat shapes and counts</h3>
        <table>
            <thead>
                <tr>
                    <th>Shape</th>
                    <th>Count</th>
                    <th>Dimensions (<span class="unit-text">mm</span>)</th>
                </tr>
            </thead>
            <tbody id="shapesTable"></tbody>
        </table>
        <p class="small">The small-top panels are triangular/trapezoid; main panels are trapezoids.</p>
    </div>

    <script>
        // Unit conversion constants
        const MM_TO_INCH = 0.0393701;
        const INCH_TO_MM = 25.4;

        // Current unit system
        let isMetric = true;

        // Conversion functions
        function mm(n) { return Number(n) }
        function mmToInches(mm) { return mm * MM_TO_INCH }
        function inchesToMm(inches) { return inches * INCH_TO_MM }

        // Convert value based on current unit system
        function convertToDisplay(value) {
            return isMetric ? value : mmToInches(value);
        }

        function convertFromDisplay(value) {
            return isMetric ? value : inchesToMm(value);
        }

        function getUnitText() {
            return isMetric ? 'mm' : 'in';
        }

        function updateUnitLabels() {
            const unitText = getUnitText();
            document.querySelectorAll('.unit-text').forEach(el => {
                el.textContent = unitText;
            });

            // Update main labels
            document.getElementById('unitTitle').textContent = isMetric ? 'metric (mm)' : 'imperial (in)';
            document.getElementById('unitLabel').textContent = unitText;
            document.getElementById('materialThickness').textContent = isMetric ? '5 mm' : '0.2 in';
        }

        function convertAllInputs() {
            const inputs = ['smallDiameter', 'mainOuterDiameter', 'mainInnerDiameter',
                'topConeHeight', 'mainUpperHeight', 'cylinderHeight', 'mainLowerHeight', 'holeDia'];

            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    const currentValue = parseFloat(input.value);
                    if (!isNaN(currentValue)) {
                        const convertedValue = convertToDisplay(convertFromDisplay(currentValue));
                        input.value = convertedValue.toFixed(isMetric ? 0 : 2);
                    }
                }
            });
        }
        function updateTotalHeight() {
            const hTopCone = convertFromDisplay(mm(document.getElementById('topConeHeight').value));
            const hMainUpper = convertFromDisplay(mm(document.getElementById('mainUpperHeight').value));
            const hCylinder = convertFromDisplay(mm(document.getElementById('cylinderHeight').value));
            const hMainLower = convertFromDisplay(mm(document.getElementById('mainLowerHeight').value));
            const totalH = hTopCone + hMainUpper + hCylinder + hMainLower;
            document.getElementById('totalHeight').value = convertToDisplay(totalH).toFixed(isMetric ? 0 : 2);
        }

        function compute() {
            // Get diameter parameters (convert to mm for calculations)
            const dSmall = convertFromDisplay(mm(document.getElementById('smallDiameter').value));
            const dMainOuter = convertFromDisplay(mm(document.getElementById('mainOuterDiameter').value));
            const dMainInner = convertFromDisplay(mm(document.getElementById('mainInnerDiameter').value));

            // Get section heights (convert to mm for calculations)
            const hTopCone = convertFromDisplay(mm(document.getElementById('topConeHeight').value));
            const hMainUpper = convertFromDisplay(mm(document.getElementById('mainUpperHeight').value));
            const hCylinder = convertFromDisplay(mm(document.getElementById('cylinderHeight').value));
            const hMainLower = convertFromDisplay(mm(document.getElementById('mainLowerHeight').value));

            // Calculate total height
            const H = hTopCone + hMainUpper + hCylinder + hMainLower;

            const nSmall = Math.max(3, Math.round(mm(document.getElementById('nSmall').value)));
            const nMain = Math.max(3, Math.round(mm(document.getElementById('nMain').value)));
            const holeDia = convertFromDisplay(mm(document.getElementById('holeDia').value));

            // Get color values
            const smallTopColor = document.getElementById('smallTopColor').value;
            const mainUpperColor = document.getElementById('mainUpperColor').value;
            const cylinderColor = document.getElementById('cylinderColor').value;
            const mainLowerColor = document.getElementById('mainLowerColor').value;
            const lineColor = document.getElementById('lineColor').value;

            // Radii
            const R_small = dSmall / 2;
            const R_mainOuter = dMainOuter / 2;
            const R_mainInner = dMainInner / 2;

            // Calculate panel geometries for each section
            // Top cone: from small diameter to main outer diameter
            const arcSmallTop = (2 * Math.PI * R_small) / nSmall;
            const arcMainOuter = (2 * Math.PI * R_mainOuter) / nSmall;
            // Calculate slant height for trapezoid panels
            const topConeSlantHeight = Math.sqrt(hTopCone * hTopCone + (R_mainOuter - R_small) * (R_mainOuter - R_small));
            const topConePanel = {
                type: 'topCone',
                count: nSmall,
                topWidth: arcSmallTop,
                bottomWidth: arcMainOuter,
                height: topConeSlantHeight
            };

            // Main upper cone: from main outer to main inner diameter
            const arcMainOuterUpper = (2 * Math.PI * R_mainOuter) / nMain;
            const arcMainInner = (2 * Math.PI * R_mainInner) / nMain;
            // Calculate slant height for trapezoid panels
            const mainUpperSlantHeight = Math.sqrt(hMainUpper * hMainUpper + (R_mainInner - R_mainOuter) * (R_mainInner - R_mainOuter));
            const mainUpperPanel = {
                type: 'mainUpper',
                count: nMain,
                topWidth: arcMainOuterUpper,
                bottomWidth: arcMainInner,
                height: mainUpperSlantHeight
            };

            // Cylinder: same width top and bottom (no slant height needed)
            const cylinderPanel = {
                type: 'cylinder',
                count: nMain,
                topWidth: arcMainInner,
                bottomWidth: arcMainInner,
                height: hCylinder
            };

            // Main lower cone: from main inner to main outer diameter
            // Calculate slant height for trapezoid panels
            const mainLowerSlantHeight = Math.sqrt(hMainLower * hMainLower + (R_mainOuter - R_mainInner) * (R_mainOuter - R_mainInner));
            const mainLowerPanel = {
                type: 'mainLower',
                count: nMain,
                topWidth: arcMainInner,
                bottomWidth: arcMainOuterUpper,
                height: mainLowerSlantHeight
            };

            // Windows: one per cylinder panel, centered in each panel
            let holeCount = 0;
            let windowPositions = [];
            if (holeDia > 0) {
                holeCount = nMain;
                for (let i = 0; i < nMain; i++) {
                    const panelAngle = (2 * Math.PI * i) / nMain;
                    const panelCenterAngle = panelAngle + (Math.PI / nMain);
                    windowPositions.push({
                        angle: panelCenterAngle,
                        radius: R_mainInner,
                        panelIndex: i
                    });
                }
            }

            return {
                H, dSmall, dMainOuter, dMainInner,
                R_small, R_mainOuter, R_mainInner,
                hTopCone, hMainUpper, hCylinder, hMainLower,
                topConePanel, mainUpperPanel, cylinderPanel, mainLowerPanel,
                holeCount, holeDia, windowPositions,
                smallTopColor, mainUpperColor, cylinderColor, mainLowerColor, lineColor
            };
        }

        function updateInputBorders() {
            const smallTopColor = document.getElementById('smallTopColor').value;
            const mainUpperColor = document.getElementById('mainUpperColor').value;
            const cylinderColor = document.getElementById('cylinderColor').value;
            const mainLowerColor = document.getElementById('mainLowerColor').value;

            // Update CSS custom properties for dynamic colors
            document.documentElement.style.setProperty('--small-top-color', smallTopColor);
            document.documentElement.style.setProperty('--main-upper-color', mainUpperColor);
            document.documentElement.style.setProperty('--cylinder-color', cylinderColor);
            document.documentElement.style.setProperty('--main-lower-color', mainLowerColor);
        }

        function render() {
            updateTotalHeight();
            updateInputBorders();
            const c = compute();
            renderTop(c);
            renderSide(c);
            renderShapesTable(c);
        }

        function renderTop(c) {
            const svg = document.getElementById('svgTop');
            clear(svg);
            const W = 1000, H = 1000; const cx = W / 2, cy = H / 2;
            const scale = (W * 0.9) / c.dMainInner;

            // Draw the three main circles
            const mainInnerR = c.R_mainInner * scale;
            const mainOuterR = c.R_mainOuter * scale;
            const smallR = c.R_small * scale;

            // Main inner circle (cylinder section)
            svg.appendChild(circle(cx, cy, mainInnerR, c.cylinderColor, '#bbb', 1));

            // Main outer circle (cone transitions) - light gray
            svg.appendChild(circle(cx, cy, mainOuterR, '#f6f6f6', '#bbb', 1));

            // Small top cap - light gray
            svg.appendChild(circle(cx, cy, smallR, '#f0f0f0', '#bbb', 1));

            // Add colored rings for each section using paths
            // Small-top cone ring (between small and main outer)
            const smallTopRing = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            smallTopRing.setAttribute('d', `M ${cx - mainOuterR},${cy} A ${mainOuterR},${mainOuterR} 0 0,1 ${cx + mainOuterR},${cy} A ${mainOuterR},${mainOuterR} 0 0,1 ${cx - mainOuterR},${cy} M ${cx - smallR},${cy} A ${smallR},${smallR} 0 0,0 ${cx + smallR},${cy} A ${smallR},${smallR} 0 0,0 ${cx - smallR},${cy} Z`);
            smallTopRing.setAttribute('fill', c.smallTopColor);
            smallTopRing.setAttribute('stroke', '#bbb');
            smallTopRing.setAttribute('stroke-width', '1');
            svg.appendChild(smallTopRing);

            // Main upper cone ring (between main outer and main inner)
            const mainUpperRing = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            mainUpperRing.setAttribute('d', `M ${cx - mainInnerR},${cy} A ${mainInnerR},${mainInnerR} 0 0,1 ${cx + mainInnerR},${cy} A ${mainInnerR},${mainInnerR} 0 0,1 ${cx - mainInnerR},${cy} M ${cx - mainOuterR},${cy} A ${mainOuterR},${mainOuterR} 0 0,0 ${cx + mainOuterR},${cy} A ${mainOuterR},${mainOuterR} 0 0,0 ${cx - mainOuterR},${cy} Z`);
            mainUpperRing.setAttribute('fill', c.mainUpperColor);
            mainUpperRing.setAttribute('stroke', '#bbb');
            mainUpperRing.setAttribute('stroke-width', '1');
            svg.appendChild(mainUpperRing);

            // Panel divisions for main sections (from main outer to main inner)
            for (let i = 0; i < c.cylinderPanel.count; i++) {
                const a1 = (2 * Math.PI * i) / c.cylinderPanel.count - Math.PI / 2;
                const x1 = cx + Math.cos(a1) * mainOuterR; const y1 = cy + Math.sin(a1) * mainOuterR;
                const x2 = cx + Math.cos(a1) * mainInnerR; const y2 = cy + Math.sin(a1) * mainInnerR;
                svg.appendChild(line(x1, y1, x2, y2, c.lineColor));
            }

            // Panel divisions for small sections (from small radius to main outer radius)
            for (let i = 0; i < c.topConePanel.count; i++) {
                const a1 = (2 * Math.PI * i) / c.topConePanel.count - Math.PI / 2;
                const x1 = cx + Math.cos(a1) * smallR; const y1 = cy + Math.sin(a1) * smallR;
                const x2 = cx + Math.cos(a1) * mainOuterR; const y2 = cy + Math.sin(a1) * mainOuterR;
                svg.appendChild(line(x1, y1, x2, y2, c.lineColor));
            }

            // Windows at cylinder section
            if (c.windowPositions) {
                for (const window of c.windowPositions) {
                    const x = cx + Math.cos(window.angle - Math.PI / 2) * mainInnerR;
                    const y = cy + Math.sin(window.angle - Math.PI / 2) * mainInnerR;
                    svg.appendChild(circle(x, y, (c.holeDia / 2) * scale, '#fff', 'black', 0.8));
                }
            }

            // Labels
            svg.appendChild(textEl(12, 20, `Main inner Ø = ${convertToDisplay(c.dMainInner).toFixed(isMetric ? 0 : 2)}${getUnitText()}`));
            svg.appendChild(textEl(12, 35, `Main outer Ø = ${convertToDisplay(c.dMainOuter).toFixed(isMetric ? 0 : 2)}${getUnitText()}`));
            svg.appendChild(textEl(12, 50, `Small Ø = ${convertToDisplay(c.dSmall).toFixed(isMetric ? 0 : 2)}${getUnitText()}`));
        }

        function renderSide(c) {
            const svg = document.getElementById('svgSide'); clear(svg);
            const W = 1000, H = 400; const margin = 60;
            const centerX = W / 2;

            // Calculate scaling to fit the UFO profile in the view
            const totalHeight = c.hTopCone + c.hMainUpper + c.hCylinder + c.hMainLower;
            const maxWidth = c.dMainInner; // Full diameter
            const scaleX = (W - 2 * margin) / maxWidth;
            const scaleY = (H - 2 * margin) / totalHeight;

            // Convert radii to screen coordinates
            const rSmall = c.R_small * scaleX;
            const rMainOuter = c.R_mainOuter * scaleX;
            const rMainInner = c.R_mainInner * scaleX;

            // Convert heights to screen coordinates
            const hTopCone = c.hTopCone * scaleY;
            const hMainUpper = c.hMainUpper * scaleY;
            const hCylinder = c.hCylinder * scaleY;
            const hMainLower = c.hMainLower * scaleY;

            // Position from bottom up (correct stacking order)
            const baseY = H - margin;
            const cylinderBottomY = baseY - hMainLower; // Main lower cone ends here
            const cylinderTopY = cylinderBottomY - hCylinder; // Cylinder ends here
            const mainUpperTopY = cylinderTopY - hMainUpper; // Main upper cone ends here
            const topConeTopY = mainUpperTopY - hTopCone; // Top cone ends here

            // Draw main lower cone (trapezoid from main inner to main outer)
            const mainLowerTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            mainLowerTrapezoid.setAttribute('points',
                `${centerX - rMainInner},${cylinderBottomY} ` +
                `${centerX + rMainInner},${cylinderBottomY} ` +
                `${centerX + rMainOuter},${baseY} ` +
                `${centerX - rMainOuter},${baseY}`
            );
            mainLowerTrapezoid.setAttribute('fill', c.mainLowerColor);
            mainLowerTrapezoid.setAttribute('stroke', '#bbb');
            mainLowerTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(mainLowerTrapezoid);

            // Draw cylinder (rectangle - straight walls)
            const cylinderRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            cylinderRect.setAttribute('x', centerX - rMainInner);
            cylinderRect.setAttribute('y', cylinderTopY);
            cylinderRect.setAttribute('width', rMainInner * 2);
            cylinderRect.setAttribute('height', hCylinder);
            cylinderRect.setAttribute('fill', c.cylinderColor);
            cylinderRect.setAttribute('stroke', '#bbb');
            cylinderRect.setAttribute('stroke-width', '2');
            svg.appendChild(cylinderRect);

            // Draw main upper cone (trapezoid from main outer to main inner)
            const mainUpperTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            mainUpperTrapezoid.setAttribute('points',
                `${centerX - rMainOuter},${mainUpperTopY} ` +
                `${centerX + rMainOuter},${mainUpperTopY} ` +
                `${centerX + rMainInner},${cylinderTopY} ` +
                `${centerX - rMainInner},${cylinderTopY}`
            );
            mainUpperTrapezoid.setAttribute('fill', c.mainUpperColor);
            mainUpperTrapezoid.setAttribute('stroke', '#bbb');
            mainUpperTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(mainUpperTrapezoid);

            // Draw top cone (trapezoid from small to main outer)
            const topConeTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            topConeTrapezoid.setAttribute('points',
                `${centerX - rSmall},${topConeTopY} ` +
                `${centerX + rSmall},${topConeTopY} ` +
                `${centerX + rMainOuter},${mainUpperTopY} ` +
                `${centerX - rMainOuter},${mainUpperTopY}`
            );
            topConeTrapezoid.setAttribute('fill', c.smallTopColor);
            topConeTrapezoid.setAttribute('stroke', '#bbb');
            topConeTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(topConeTrapezoid);

            // Add dimension labels
            svg.appendChild(textEl(10, 20, `Side view - Total height: ${convertToDisplay(c.H).toFixed(isMetric ? 0 : 2)}${getUnitText()}`));
            svg.appendChild(textEl(10, 35, `Top: ${convertToDisplay(c.hTopCone).toFixed(isMetric ? 0 : 2)}${getUnitText()}, Upper: ${convertToDisplay(c.hMainUpper).toFixed(isMetric ? 0 : 2)}${getUnitText()}, Cyl: ${convertToDisplay(c.hCylinder).toFixed(isMetric ? 0 : 2)}${getUnitText()}, Lower: ${convertToDisplay(c.hMainLower).toFixed(isMetric ? 0 : 2)}${getUnitText()}`));
        }


        function renderShapesTable(c) {
            const tbody = document.getElementById('shapesTable'); tbody.innerHTML = '';
            const rows = [];

            // Add all panel types
            const unit = getUnitText();
            const precision = isMetric ? 1 : 2;

            rows.push({
                name: 'Top cone panel (trapezoid)',
                count: c.topConePanel.count,
                dim: `top width ${convertToDisplay(c.topConePanel.topWidth).toFixed(precision)} ${unit} × bottom width ${convertToDisplay(c.topConePanel.bottomWidth).toFixed(precision)} ${unit} × height ${convertToDisplay(c.topConePanel.height).toFixed(precision)} ${unit}`
            });
            rows.push({
                name: 'Main upper cone panel (trapezoid)',
                count: c.mainUpperPanel.count,
                dim: `top width ${convertToDisplay(c.mainUpperPanel.topWidth).toFixed(precision)} ${unit} × bottom width ${convertToDisplay(c.mainUpperPanel.bottomWidth).toFixed(precision)} ${unit} × height ${convertToDisplay(c.mainUpperPanel.height).toFixed(precision)} ${unit}`
            });
            rows.push({
                name: 'Cylinder panel (rectangle)',
                count: c.cylinderPanel.count,
                dim: `width ${convertToDisplay(c.cylinderPanel.topWidth).toFixed(precision)} ${unit} × height ${convertToDisplay(c.cylinderPanel.height).toFixed(precision)} ${unit}`
            });
            rows.push({
                name: 'Main lower cone panel (trapezoid)',
                count: c.mainLowerPanel.count,
                dim: `top width ${convertToDisplay(c.mainLowerPanel.topWidth).toFixed(precision)} ${unit} × bottom width ${convertToDisplay(c.mainLowerPanel.bottomWidth).toFixed(precision)} ${unit} × height ${convertToDisplay(c.mainLowerPanel.height).toFixed(precision)} ${unit}`
            });

            if (c.holeCount > 0) {
                rows.push({
                    name: 'Window holes (on cylinder)',
                    count: c.holeCount,
                    dim: `diameter ${convertToDisplay(c.holeDia).toFixed(precision)} ${unit} around cylinder circumference`
                });
            }

            for (const r of rows) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${r.name}</td><td>${r.count}</td><td>${r.dim}</td>`;
                tbody.appendChild(tr);
            }
        }

        function clear(svg) { while (svg.firstChild) svg.removeChild(svg.firstChild) }
        function circle(cx, cy, r, fill = '#fff', stroke = '#999', opacity = 1) { const el = document.createElementNS('http://www.w3.org/2000/svg', 'circle'); el.setAttribute('cx', cx); el.setAttribute('cy', cy); el.setAttribute('r', r); el.setAttribute('fill', fill); el.setAttribute('stroke', stroke); el.setAttribute('opacity', opacity); return el }
        function line(x1, y1, x2, y2, color) { const l = document.createElementNS('http://www.w3.org/2000/svg', 'line'); l.setAttribute('x1', x1); l.setAttribute('y1', y1); l.setAttribute('x2', x2); l.setAttribute('y2', y2); l.setAttribute('stroke', color); l.setAttribute('stroke-width', '2'); return l }
        function textEl(x, y, text) { const t = document.createElementNS('http://www.w3.org/2000/svg', 'text'); t.setAttribute('x', x); t.setAttribute('y', y); t.setAttribute('font-size', 12); t.setAttribute('fill', '#333'); t.textContent = text; return t }

        // Export basic flat-panel SVG (single combined SVG containing one of each unique shape scaled to view)
        function exportSVG() {
            const c = compute();
            const svgNS = 'http://www.w3.org/2000/svg';
            const doc = document.createElementNS(svgNS, 'svg');
            doc.setAttribute('xmlns', svgNS);
            // create small panel drawing
            const pad = 20; let x = pad, y = pad;
            const sW = Math.max(200, c.smallPanel.bottomWidth + 60);
            const sH = c.smallPanel.height + 60;
            const smallGroup = document.createElementNS(svgNS, 'g');
            const bottomW = c.smallPanel.bottomWidth;
            const h = c.smallPanel.height;
            // small is triangle/trapezoid with top 0
            const points = `${x + sW / 2},${y} ${x + sW},${y + sH} ${x},${y + sH}`;
            const poly = document.createElementNS(svgNS, 'polygon'); poly.setAttribute('points', points); poly.setAttribute('fill', '#fff'); poly.setAttribute('stroke', '#000'); smallGroup.appendChild(poly);
            // tab on right
            const tab = document.createElementNS(svgNS, 'rect'); tab.setAttribute('x', x + sW + 2); tab.setAttribute('y', y + sH / 2 - c.smallPanel.tabWidth / 2); tab.setAttribute('width', c.smallPanel.tabWidth); tab.setAttribute('height', c.smallPanel.tabWidth * 1.8); tab.setAttribute('fill', '#fff'); tab.setAttribute('stroke', '#000'); smallGroup.appendChild(tab);
            doc.appendChild(smallGroup);

            // main panel
            x += sW + pad;
            const mainGroup = document.createElementNS(svgNS, 'g');
            const topW = c.mainPanel.topWidth; const botW = c.mainPanel.bottomWidth; const mh = c.mainPanel.height;
            const points2 = `${x + (sW / 2 - topW / 2)},${y} ${x + (sW / 2 + topW / 2)},${y} ${x + (sW / 2 + botW / 2)},${y + mh} ${x + (sW / 2 - botW / 2)},${y + mh}`;
            const poly2 = document.createElementNS(svgNS, 'polygon'); poly2.setAttribute('points', points2); poly2.setAttribute('fill', '#fff'); poly2.setAttribute('stroke', '#000'); mainGroup.appendChild(poly2);
            // tab
            const tab2 = document.createElementNS(svgNS, 'rect'); tab2.setAttribute('x', x + sW / 2 + botW / 2 + 2); tab2.setAttribute('y', y + mh / 2 - c.mainPanel.tabWidth / 2); tab2.setAttribute('width', c.mainPanel.tabWidth); tab2.setAttribute('height', c.mainPanel.tabWidth * 2); tab2.setAttribute('fill', '#fff'); tab2.setAttribute('stroke', '#000'); mainGroup.appendChild(tab2);
            doc.appendChild(mainGroup);

            // serialize and trigger download
            const serializer = new XMLSerializer(); const str = serializer.serializeToString(doc);
            const blob = new Blob([str], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'ufo_panels.svg'; document.body.appendChild(a); a.click(); a.remove();
        }

        // Unit toggle handler
        function handleUnitToggle() {
            const toggle = document.getElementById('unitToggle');
            isMetric = toggle.value === 'metric';
            updateUnitLabels();
            convertAllInputs();
            render();
        }

        // live updates
        // Auto-update on all parameter changes
        const allInputs = ['smallDiameter', 'mainOuterDiameter', 'mainInnerDiameter', 'topConeHeight', 'mainUpperHeight', 'cylinderHeight', 'mainLowerHeight', 'nSmall', 'nMain', 'holeDia', 'lineColor', 'smallTopColor', 'mainUpperColor', 'cylinderColor', 'mainLowerColor'];
        allInputs.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', render);
                element.addEventListener('change', render);
            }
        });

        // Add unit toggle listener
        document.getElementById('unitToggle').addEventListener('change', handleUnitToggle);

        // initial
        render();
    </script>
</body>

</html>