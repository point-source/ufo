<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UFO Parametric Cutter (metric)</title>
    <style>
        body {
            font-family: system-ui, Segoe UI, Roboto, Arial;
            margin: 18px;
            color: #111
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            max-width: 1200px
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 6px
        }

        input,
        select {
            width: 100%;
            padding: 6px 8px;
            font-size: 14px;
            box-sizing: border-box
        }

        .row {
            margin-bottom: 8px
        }

        .panel {
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 8px;
            background: #fafafa
        }

        .flex {
            display: flex;
            gap: 12px
        }

        .preview {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px
        }

        svg {
            border: 1px solid #ccc;
            background: white;
            width: 100%;
            height: 360px
        }

        .shapes {
            margin-top: 12px
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        td,
        th {
            padding: 6px;
            border: 1px solid #eee;
            font-size: 13px
        }

        button {
            padding: 8px 12px;
            font-size: 14px
        }

        .small {
            font-size: 12px;
            color: #555
        }
    </style>
</head>

<body>
    <h1>UFO parametric cutter — metric (mm)</h1>
    <p class="small">Interactive single-file generator: enter sizes (mm), adjust panels, and see preview + flat panel
        shapes and counts. Material thickness fixed to 5 mm (foam board) — suitable for hand-fitting and taping.</p>
    <div class="controls panel">
        <div>
            <div class="row"><label>Small diameter (mm) - top cap only</label><input id="smallDiameter" type="number"
                    value="260"></div>
            <div class="row"><label>Main outer diameter (mm) - cone transitions</label><input id="mainOuterDiameter"
                    type="number" value="410"></div>
            <div class="row"><label>Main inner diameter (mm) - cylinder walls</label><input id="mainInnerDiameter"
                    type="number" value="914"></div>
            <div class="row"><label>Total height (mm) - calculated from sections</label><input id="totalHeight"
                    type="number" value="0" readonly></div>
        </div>
        <div>
            <div class="row"><label>Top cone height (mm)</label><input id="topConeHeight" type="number" value="160">
            </div>
            <div class="row"><label>Main upper cone height (mm)</label><input id="mainUpperHeight" type="number"
                    value="130"></div>
            <div class="row"><label>Cylinder height (mm)</label><input id="cylinderHeight" type="number" value="60">
            </div>
            <div class="row"><label>Main lower cone height (mm)</label><input id="mainLowerHeight" type="number"
                    value="130"></div>
        </div>
        <div>
            <div class="row"><label>Small-top panel count (N)</label><input id="nSmall" type="number" value="16"
                    min="3"></div>
            <div class="row"><label>Main-ring panel count (N)</label><input id="nMain" type="number" value="32" min="3">
            </div>
            <div class="row"><label>Hole diameter for windows (mm)</label><input id="holeDia" type="number"
                    value="25.4"></div>
        </div>
    </div>
    <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
        <div class="small">Views update automatically as you change values.</div>
    </div>

    <div class="preview">
        <div class="panel">
            <h3>Top-down</h3>
            <svg id="svgTop" viewBox="0 0 1000 1000" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <div class="panel">
            <h3>Side view</h3>
            <svg id="svgSide" viewBox="0 0 1000 400" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
    </div>

    <div class="shapes panel">
        <h3>Unique flat shapes and counts</h3>
        <table>
            <thead>
                <tr>
                    <th>Shape</th>
                    <th>Count</th>
                    <th>Dimensions (mm)</th>
                </tr>
            </thead>
            <tbody id="shapesTable"></tbody>
        </table>
        <p class="small">The small-top panels are triangular/trapezoid; main panels are trapezoids.</p>
    </div>

    <script>
        function mm(n) { return Number(n) }
        function updateTotalHeight() {
            const hTopCone = mm(document.getElementById('topConeHeight').value);
            const hMainUpper = mm(document.getElementById('mainUpperHeight').value);
            const hCylinder = mm(document.getElementById('cylinderHeight').value);
            const hMainLower = mm(document.getElementById('mainLowerHeight').value);
            const totalH = hTopCone + hMainUpper + hCylinder + hMainLower;
            document.getElementById('totalHeight').value = Math.round(totalH);
        }

        function compute() {
            // Get diameter parameters
            const dSmall = mm(document.getElementById('smallDiameter').value);
            const dMainOuter = mm(document.getElementById('mainOuterDiameter').value);
            const dMainInner = mm(document.getElementById('mainInnerDiameter').value);

            // Get section heights
            const hTopCone = mm(document.getElementById('topConeHeight').value);
            const hMainUpper = mm(document.getElementById('mainUpperHeight').value);
            const hCylinder = mm(document.getElementById('cylinderHeight').value);
            const hMainLower = mm(document.getElementById('mainLowerHeight').value);

            // Calculate total height
            const H = hTopCone + hMainUpper + hCylinder + hMainLower;

            const nSmall = Math.max(3, Math.round(mm(document.getElementById('nSmall').value)));
            const nMain = Math.max(3, Math.round(mm(document.getElementById('nMain').value)));
            const holeDia = mm(document.getElementById('holeDia').value);

            // Radii
            const R_small = dSmall / 2;
            const R_mainOuter = dMainOuter / 2;
            const R_mainInner = dMainInner / 2;

            // Calculate panel geometries for each section
            // Top cone: from small diameter to main outer diameter
            const arcSmallTop = (2 * Math.PI * R_small) / nSmall;
            const arcMainOuter = (2 * Math.PI * R_mainOuter) / nSmall;
            // Calculate slant height for trapezoid panels
            const topConeSlantHeight = Math.sqrt(hTopCone * hTopCone + (R_mainOuter - R_small) * (R_mainOuter - R_small));
            const topConePanel = {
                type: 'topCone',
                count: nSmall,
                topWidth: arcSmallTop,
                bottomWidth: arcMainOuter,
                height: topConeSlantHeight
            };

            // Main upper cone: from main outer to main inner diameter
            const arcMainOuterUpper = (2 * Math.PI * R_mainOuter) / nMain;
            const arcMainInner = (2 * Math.PI * R_mainInner) / nMain;
            // Calculate slant height for trapezoid panels
            const mainUpperSlantHeight = Math.sqrt(hMainUpper * hMainUpper + (R_mainInner - R_mainOuter) * (R_mainInner - R_mainOuter));
            const mainUpperPanel = {
                type: 'mainUpper',
                count: nMain,
                topWidth: arcMainOuterUpper,
                bottomWidth: arcMainInner,
                height: mainUpperSlantHeight
            };

            // Cylinder: same width top and bottom (no slant height needed)
            const cylinderPanel = {
                type: 'cylinder',
                count: nMain,
                topWidth: arcMainInner,
                bottomWidth: arcMainInner,
                height: hCylinder
            };

            // Main lower cone: from main inner to main outer diameter
            // Calculate slant height for trapezoid panels
            const mainLowerSlantHeight = Math.sqrt(hMainLower * hMainLower + (R_mainOuter - R_mainInner) * (R_mainOuter - R_mainInner));
            const mainLowerPanel = {
                type: 'mainLower',
                count: nMain,
                topWidth: arcMainInner,
                bottomWidth: arcMainOuterUpper,
                height: mainLowerSlantHeight
            };

            // Windows: one per cylinder panel, centered in each panel
            let holeCount = 0;
            let windowPositions = [];
            if (holeDia > 0) {
                holeCount = nMain;
                for (let i = 0; i < nMain; i++) {
                    const panelAngle = (2 * Math.PI * i) / nMain;
                    const panelCenterAngle = panelAngle + (Math.PI / nMain);
                    windowPositions.push({
                        angle: panelCenterAngle,
                        radius: R_mainInner,
                        panelIndex: i
                    });
                }
            }

            return {
                H, dSmall, dMainOuter, dMainInner,
                R_small, R_mainOuter, R_mainInner,
                hTopCone, hMainUpper, hCylinder, hMainLower,
                topConePanel, mainUpperPanel, cylinderPanel, mainLowerPanel,
                holeCount, holeDia, windowPositions
            };
        }

        function render() {
            updateTotalHeight();
            const c = compute();
            renderTop(c);
            renderSide(c);
            renderShapesTable(c);
        }

        function renderTop(c) {
            const svg = document.getElementById('svgTop');
            clear(svg);
            const W = 1000, H = 1000; const cx = W / 2, cy = H / 2;
            const scale = (W * 0.9) / c.dMainInner;

            // Draw the three main circles
            const mainInnerR = c.R_mainInner * scale;
            const mainOuterR = c.R_mainOuter * scale;
            const smallR = c.R_small * scale;

            // Main inner circle (cylinder section)
            svg.appendChild(circle(cx, cy, mainInnerR, '#e6f3ff', '#bbb', 1));

            // Main outer circle (cone transitions)
            svg.appendChild(circle(cx, cy, mainOuterR, '#f6f6f6', '#bbb', 1));

            // Small top cap
            svg.appendChild(circle(cx, cy, smallR, '#eee', '#bbb', 1));

            // Panel divisions for main sections
            for (let i = 0; i < c.cylinderPanel.count; i++) {
                const a1 = (2 * Math.PI * i) / c.cylinderPanel.count - Math.PI / 2;
                const x1 = cx + Math.cos(a1) * mainInnerR; const y1 = cy + Math.sin(a1) * mainInnerR;
                svg.appendChild(line(cx, cy, x1, y1, '#bbb'));
            }

            // Panel divisions for small sections
            for (let i = 0; i < c.topConePanel.count; i++) {
                const a1 = (2 * Math.PI * i) / c.topConePanel.count - Math.PI / 2;
                const x1 = cx + Math.cos(a1) * smallR; const y1 = cy + Math.sin(a1) * smallR;
                svg.appendChild(line(cx, cy, x1, y1, '#bbb'));
            }

            // Windows at cylinder section
            if (c.windowPositions) {
                for (const window of c.windowPositions) {
                    const x = cx + Math.cos(window.angle - Math.PI / 2) * mainInnerR;
                    const y = cy + Math.sin(window.angle - Math.PI / 2) * mainInnerR;
                    svg.appendChild(circle(x, y, (c.holeDia / 2) * scale, '#fff', 'black', 0.8));
                }
            }

            // Labels
            svg.appendChild(textEl(12, 20, `Main inner Ø = ${c.dMainInner}mm`));
            svg.appendChild(textEl(12, 35, `Main outer Ø = ${c.dMainOuter}mm`));
            svg.appendChild(textEl(12, 50, `Small Ø = ${c.dSmall}mm`));
        }

        function renderSide(c) {
            const svg = document.getElementById('svgSide'); clear(svg);
            const W = 1000, H = 400; const margin = 60;
            const centerX = W / 2;

            // Calculate scaling to fit the UFO profile in the view
            const totalHeight = c.hTopCone + c.hMainUpper + c.hCylinder + c.hMainLower;
            const maxWidth = c.dMainInner; // Full diameter
            const scaleX = (W - 2 * margin) / maxWidth;
            const scaleY = (H - 2 * margin) / totalHeight;

            // Convert radii to screen coordinates
            const rSmall = c.R_small * scaleX;
            const rMainOuter = c.R_mainOuter * scaleX;
            const rMainInner = c.R_mainInner * scaleX;

            // Convert heights to screen coordinates
            const hTopCone = c.hTopCone * scaleY;
            const hMainUpper = c.hMainUpper * scaleY;
            const hCylinder = c.hCylinder * scaleY;
            const hMainLower = c.hMainLower * scaleY;

            // Position from bottom up (correct stacking order)
            const baseY = H - margin;
            const cylinderBottomY = baseY - hMainLower; // Main lower cone ends here
            const cylinderTopY = cylinderBottomY - hCylinder; // Cylinder ends here
            const mainUpperTopY = cylinderTopY - hMainUpper; // Main upper cone ends here
            const topConeTopY = mainUpperTopY - hTopCone; // Top cone ends here

            // Draw main lower cone (trapezoid from main inner to main outer)
            const mainLowerTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            mainLowerTrapezoid.setAttribute('points',
                `${centerX - rMainInner},${cylinderBottomY} ` +
                `${centerX + rMainInner},${cylinderBottomY} ` +
                `${centerX + rMainOuter},${baseY} ` +
                `${centerX - rMainOuter},${baseY}`
            );
            mainLowerTrapezoid.setAttribute('fill', '#f6f6f6');
            mainLowerTrapezoid.setAttribute('stroke', '#bbb');
            mainLowerTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(mainLowerTrapezoid);

            // Draw cylinder (rectangle - straight walls)
            const cylinderRect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            cylinderRect.setAttribute('x', centerX - rMainInner);
            cylinderRect.setAttribute('y', cylinderTopY);
            cylinderRect.setAttribute('width', rMainInner * 2);
            cylinderRect.setAttribute('height', hCylinder);
            cylinderRect.setAttribute('fill', '#e6f3ff');
            cylinderRect.setAttribute('stroke', '#bbb');
            cylinderRect.setAttribute('stroke-width', '2');
            svg.appendChild(cylinderRect);

            // Draw main upper cone (trapezoid from main outer to main inner)
            const mainUpperTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            mainUpperTrapezoid.setAttribute('points',
                `${centerX - rMainOuter},${mainUpperTopY} ` +
                `${centerX + rMainOuter},${mainUpperTopY} ` +
                `${centerX + rMainInner},${cylinderTopY} ` +
                `${centerX - rMainInner},${cylinderTopY}`
            );
            mainUpperTrapezoid.setAttribute('fill', '#f6f6f6');
            mainUpperTrapezoid.setAttribute('stroke', '#bbb');
            mainUpperTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(mainUpperTrapezoid);

            // Draw top cone (trapezoid from small to main outer)
            const topConeTrapezoid = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            topConeTrapezoid.setAttribute('points',
                `${centerX - rSmall},${topConeTopY} ` +
                `${centerX + rSmall},${topConeTopY} ` +
                `${centerX + rMainOuter},${mainUpperTopY} ` +
                `${centerX - rMainOuter},${mainUpperTopY}`
            );
            topConeTrapezoid.setAttribute('fill', '#eee');
            topConeTrapezoid.setAttribute('stroke', '#bbb');
            topConeTrapezoid.setAttribute('stroke-width', '2');
            svg.appendChild(topConeTrapezoid);

            // Add dimension labels
            svg.appendChild(textEl(10, 20, `Side view - Total height: ${c.H}mm`));
            svg.appendChild(textEl(10, 35, `Top: ${c.hTopCone}mm, Upper: ${c.hMainUpper}mm, Cyl: ${c.hCylinder}mm, Lower: ${c.hMainLower}mm`));
        }


        function renderShapesTable(c) {
            const tbody = document.getElementById('shapesTable'); tbody.innerHTML = '';
            const rows = [];

            // Add all panel types
            rows.push({
                name: 'Top cone panel (trapezoid)',
                count: c.topConePanel.count,
                dim: `top width ${c.topConePanel.topWidth.toFixed(1)} mm × bottom width ${c.topConePanel.bottomWidth.toFixed(1)} mm × height ${c.topConePanel.height.toFixed(1)} mm`
            });
            rows.push({
                name: 'Main upper cone panel (trapezoid)',
                count: c.mainUpperPanel.count,
                dim: `top width ${c.mainUpperPanel.topWidth.toFixed(1)} mm × bottom width ${c.mainUpperPanel.bottomWidth.toFixed(1)} mm × height ${c.mainUpperPanel.height.toFixed(1)} mm`
            });
            rows.push({
                name: 'Cylinder panel (rectangle)',
                count: c.cylinderPanel.count,
                dim: `width ${c.cylinderPanel.topWidth.toFixed(1)} mm × height ${c.cylinderPanel.height.toFixed(1)} mm`
            });
            rows.push({
                name: 'Main lower cone panel (trapezoid)',
                count: c.mainLowerPanel.count,
                dim: `top width ${c.mainLowerPanel.topWidth.toFixed(1)} mm × bottom width ${c.mainLowerPanel.bottomWidth.toFixed(1)} mm × height ${c.mainLowerPanel.height.toFixed(1)} mm`
            });

            if (c.holeCount > 0) {
                rows.push({
                    name: 'Window holes (on cylinder)',
                    count: c.holeCount,
                    dim: `diameter ${c.holeDia} mm around cylinder circumference`
                });
            }

            for (const r of rows) {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${r.name}</td><td>${r.count}</td><td>${r.dim}</td>`;
                tbody.appendChild(tr);
            }
        }

        function clear(svg) { while (svg.firstChild) svg.removeChild(svg.firstChild) }
        function circle(cx, cy, r, fill = '#fff', stroke = '#999', opacity = 1) { const el = document.createElementNS('http://www.w3.org/2000/svg', 'circle'); el.setAttribute('cx', cx); el.setAttribute('cy', cy); el.setAttribute('r', r); el.setAttribute('fill', fill); el.setAttribute('stroke', stroke); el.setAttribute('opacity', opacity); return el }
        function line(x1, y1, x2, y2, color) { const l = document.createElementNS('http://www.w3.org/2000/svg', 'line'); l.setAttribute('x1', x1); l.setAttribute('y1', y1); l.setAttribute('x2', x2); l.setAttribute('y2', y2); l.setAttribute('stroke', color); return l }
        function textEl(x, y, text) { const t = document.createElementNS('http://www.w3.org/2000/svg', 'text'); t.setAttribute('x', x); t.setAttribute('y', y); t.setAttribute('font-size', 12); t.setAttribute('fill', '#333'); t.textContent = text; return t }

        // Export basic flat-panel SVG (single combined SVG containing one of each unique shape scaled to view)
        function exportSVG() {
            const c = compute();
            const svgNS = 'http://www.w3.org/2000/svg';
            const doc = document.createElementNS(svgNS, 'svg');
            doc.setAttribute('xmlns', svgNS);
            // create small panel drawing
            const pad = 20; let x = pad, y = pad;
            const sW = Math.max(200, c.smallPanel.bottomWidth + 60);
            const sH = c.smallPanel.height + 60;
            const smallGroup = document.createElementNS(svgNS, 'g');
            const bottomW = c.smallPanel.bottomWidth;
            const h = c.smallPanel.height;
            // small is triangle/trapezoid with top 0
            const points = `${x + sW / 2},${y} ${x + sW},${y + sH} ${x},${y + sH}`;
            const poly = document.createElementNS(svgNS, 'polygon'); poly.setAttribute('points', points); poly.setAttribute('fill', '#fff'); poly.setAttribute('stroke', '#000'); smallGroup.appendChild(poly);
            // tab on right
            const tab = document.createElementNS(svgNS, 'rect'); tab.setAttribute('x', x + sW + 2); tab.setAttribute('y', y + sH / 2 - c.smallPanel.tabWidth / 2); tab.setAttribute('width', c.smallPanel.tabWidth); tab.setAttribute('height', c.smallPanel.tabWidth * 1.8); tab.setAttribute('fill', '#fff'); tab.setAttribute('stroke', '#000'); smallGroup.appendChild(tab);
            doc.appendChild(smallGroup);

            // main panel
            x += sW + pad;
            const mainGroup = document.createElementNS(svgNS, 'g');
            const topW = c.mainPanel.topWidth; const botW = c.mainPanel.bottomWidth; const mh = c.mainPanel.height;
            const points2 = `${x + (sW / 2 - topW / 2)},${y} ${x + (sW / 2 + topW / 2)},${y} ${x + (sW / 2 + botW / 2)},${y + mh} ${x + (sW / 2 - botW / 2)},${y + mh}`;
            const poly2 = document.createElementNS(svgNS, 'polygon'); poly2.setAttribute('points', points2); poly2.setAttribute('fill', '#fff'); poly2.setAttribute('stroke', '#000'); mainGroup.appendChild(poly2);
            // tab
            const tab2 = document.createElementNS(svgNS, 'rect'); tab2.setAttribute('x', x + sW / 2 + botW / 2 + 2); tab2.setAttribute('y', y + mh / 2 - c.mainPanel.tabWidth / 2); tab2.setAttribute('width', c.mainPanel.tabWidth); tab2.setAttribute('height', c.mainPanel.tabWidth * 2); tab2.setAttribute('fill', '#fff'); tab2.setAttribute('stroke', '#000'); mainGroup.appendChild(tab2);
            doc.appendChild(mainGroup);

            // serialize and trigger download
            const serializer = new XMLSerializer(); const str = serializer.serializeToString(doc);
            const blob = new Blob([str], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'ufo_panels.svg'; document.body.appendChild(a); a.click(); a.remove();
        }

        // live updates
        // Auto-update on all parameter changes
        const allInputs = ['smallDiameter', 'mainOuterDiameter', 'mainInnerDiameter', 'topConeHeight', 'mainUpperHeight', 'cylinderHeight', 'mainLowerHeight', 'nSmall', 'nMain', 'holeDia'];
        allInputs.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', render);
                element.addEventListener('change', render);
            }
        });
        // initial
        render();
    </script>
</body>

</html>